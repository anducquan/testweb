<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ƒêang xem phim</title>
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* Kh√≥a ch·∫∑t body v√†o m√†n h√¨nh, h·ªó tr·ª£ 100dvh cho mobile ƒë·ªùi m·ªõi */
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; height: 100dvh; 
            background-color: #000; overflow: hidden; 
            position: fixed; top: 0; left: 0;
        }
        
        /* Khung video √©p full 100% kh√¥ng cho tr√†n */
        .artplayer-app { 
            position: absolute; top: 0; bottom: 0; left: 0; right: 0;
            width: 100%; height: 100%; 
            padding-bottom: env(safe-area-inset-bottom); /* N√© d·∫£i ƒëen vu·ªët Home tr√™n iPhone */
        }
        
        .back-btn { 
            position: absolute; top: 15px; left: 15px; z-index: 9999; 
            background: rgba(0,0,0,0.6); color: white; padding: 8px 15px; 
            border-radius: 5px; text-decoration: none; font-family: sans-serif; 
            backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);
        }
        .error-msg { color: white; text-align: center; padding-top: 100px; font-family: sans-serif; display: none; position: relative; z-index: 10;}
    </style>
</head>
<body>
    <a href="javascript:history.back()" class="back-btn">‚Üê Quay l·∫°i</a>
    
    <div class="artplayer-app" id="player-container"></div>
    <div class="error-msg" id="error-msg"><h2>Kh√¥ng t√¨m th·∫•y ngu·ªìn ph√°t!</h2></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let videoUrl = decodeURIComponent(urlParams.get('url'));

        if (!videoUrl || videoUrl === 'null') {
            document.getElementById('error-msg').style.display = 'block';
        } else {
            var art = new Artplayer({
                container: '.artplayer-app',
                url: videoUrl,
                type: 'm3u8',
                volume: 1, 
                autoplay: true, 
                pip: true, 
                screenshot: true, 
                setting: true, 
                playbackRate: true, 
                aspectRatio: true,  
                flip: true,         
                fullscreen: true, 
                fullscreenWeb: true, 
                playsInline: true, 
                autoSize: true, // √âp video t·ª± co gi√£n v·ª´a khung
                autoOrientation: true, // Xoay ngang m√†n h√¨nh
                lockDeviceOrientation: true, // Kh√≥a m√†n h√¨nh khi full
                airplay: true,

                // üëâ √âP HI·ªÇN TH·ªä N√öT AIRPLAY (GI·ªêNG ·∫¢NH C·ª¶A B·∫†N)
            controls: [
                {
                    position: 'right', // ƒê·∫∑t c·∫°nh n√∫t C√†i ƒë·∫∑t ·ªü g√≥c ph·∫£i
                    html: '<svg viewBox="0 0 1024 1024" width="22" height="22" fill="#fff"><path d="M853.333 768h-170.666v-85.333h170.666v-512h-682.666v512h170.666v85.333h-170.666c-46.934 0-85.334-38.4-85.334-85.333v-512c0-46.933 38.4-85.333 85.334-85.333h682.666c46.933 0 85.333 38.4 85.333 85.333v512c0 46.933-38.4 85.333-85.333 85.333zM512 682.667l-170.667 170.666h341.334l-170.667-170.666z"></path></svg>',
                    tooltip: 'AirPlay & √Çm thanh',
                    click: function () {
                        const video = art.video;
                        // G·ªçi API g·ªëc c·ªßa Apple ƒë·ªÉ √©p m·ªü b·∫£ng ƒë·ªïi Loa / Tai nghe / TV
                        if (video.webkitShowPlaybackTargetPicker) {
                            video.webkitShowPlaybackTargetPicker();
                        } else {
                            art.notice.show('T√≠nh nƒÉng n√†y ch·ªâ ho·∫°t ƒë·ªông tr√™n iPhone/iPad (Safari)');
                        }
                    }
                }
            ],
            
                customType: {
                    m3u8: function (video, url, art) {
                        if (Hls.isSupported()) {
                            const hls = new Hls();
                            hls.loadSource(url);
                            hls.attachMedia(video);
                            art.hls = hls;
                            
                            hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
                                if (data.levels.length > 1) {
                                    let quality = data.levels.map((level, index) => ({
                                        default: index === data.levels.length - 1,
                                        html: level.height + 'P',
                                        level: index,
                                    }));
                                    art.setting.add({
                                        html: 'Ch·∫•t l∆∞·ª£ng',
                                        selector: quality,
                                        onSelect: function (item) {
                                            hls.currentLevel = item.level;
                                            return item.html;
                                        },
                                    });
                                }
                            });
                            art.on('destroy', () => hls.destroy());
                        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                            video.src = url;
                        } else { 
                            art.notice.show = 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ HLS'; 
                        }
                    },
                },
            });
        }
    </script>
</body>
</html>